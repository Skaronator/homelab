image:
  repository: "dxflrs/garage"
  tag: "v2.0.0@sha256:15b40e0dddd2e611aa746ff6f7c3bfe9f22735e4a2cc29e0abd89c268e9b79d9"

ports:
  - name: main
    containerPort: 3900
  - name: web
    containerPort: 3902
  - name: admin
    containerPort: 3903

health:
  port: admin

ingress:
  host: s3.wagner.gg

secretEnvs:
  - GARAGE_ADMIN_TOKEN: AgDCMFf/jtc26n6Q0kewFCfDPEXEO0gT4dz3N3TnS1ejeJGLHFlSt+oVC4LNlct89tdBXPw/VgwmtdPSEIz4ksuHtw6DPEWv4zfQhohDr19J+jJ6cildQYOyaDcT9XQMgPO+CGWUiu5VJuYi/lsKVzzz+X+BLmljjwmLObsW7IleyDjYZibbpSUDhs5D05eWSeMtoud3MvtDov5RoZfKc49elXEtujuE6/0GwUqdUfst9kDF6R8smUBzeKI3FfqtxaLtvPbuKWCEE3sVy/H743Jj31Zdg8/btgTODLIXhPGGYO7Icn6p4VjpD+bObZ0SlPJlQN+m5I5eDvtIgi2p2N2dNbM5yXcrsSeT40PYhqJra2zbmbz4CDeM+iUHw7UED+pXtkNRkqWYelS7D1Ip80iEKSM9QTZbHpgWoGPi4gKXFM1Aphg3QV2sQS3ZIegRK8Wz9w1d0r3CNo25N64Bz7YLVU0HkFoXeN3PpLRD3bQRqo2Iav/5GZm3uCoCREQTrWvBY2yhD5tJ1wGLZwXztlOg820HDcFVSxd90shkCzCk1xU/bDRt7tj3qx5CyEKzUS/kcjGKCPz69tdGSxkHiRxfszN4kECfZ5B1Od17SBxwe+pEGjB+CvVtA9SOnNfwm6iwso03nSM189e6aNRM577GxMKi+0ciEleDyRiVYAOLSPn4N6WvkFLrEUEzPYAEq4oIT5WSBDM0V793vtLfpgSJXFSGT4edmLlQrfcFylz/jr1anCFvyBEedM3X7WBMhdfg9tRTuLYhHsrGLiQ+ma8x
  - GARAGE_RPC_SECRET: AgBIyO5ZvECeRfbq2K71ykJKHm8lKXYLy3eA6Snkz/49uzoXqa9RkqHzDrxy5prnNPBTIiqL6p6j6z5Pq1ziZnSxyjby6YrfLL+S5v/90yZX7/xqBiCAR0fBPbDs5XyeRyCGsHnSS31hx59rDrPUVl0LtDhmpXuyYQl/gqKEYaUGHKYdAJ62sHcm8EBugf13jPuvIiZMHubHjBaAI6nJa8/gfA6swgrGJSC7YUSPhV0gDtLdLd25KZvDXSpQ6V+GeJJs+GqGmKwFotF3q74EI057n5423lN0yFZD56ffzpeKM9X7IJQhPzZylXhpSSIuu+K3tlmOxwR+Ddm+2kqFB2tg9popUpI+xPbISelm8uk1eDvrcWcpJ8IackECXgk3aiR85xqBbgZWkGeYDlrkpoORUnn9OxXWSDIGyNaYl+61+fmZyCjCtVplvjhAEh9OvrxFRa6LbDOIGpMFdcRsyZ3USzN3zGR+VVnAH/nk7p3cYpTZ/ABei9gP6Pzc7ZA4c0/PgN9/pU/9oPPoKyarrYesB0sbe2qTIKJu29cFSp/V8oqNlPWDKugsErdKNNm/n1Hpt6xJ1L361ofuAAwxFfYwruyWt8cz3PNaRompwUyUR0/1D+S/7Q0v0A00hMuDHP9CBhAyHMaw9cXMgl47PJPxa2I3Gw34DJQb0toLDf/VVkdu9Uk5pjimfwEVdM6IDV5deAnl2f8xVeFoXqBG4nknF1hI1kYUL1qPDoCbkugB0H0Hw/W81+t1rUJABxU3LXf0fPrMvlINVzfPU95TkciC

configMaps:
  - name: config
    mountPath: /etc
    subPath: garage.toml
    content: |
      metadata_dir = "/var/lib/garage/meta"
      data_dir = "/var/lib/garage/data"
      db_engine = "lmdb"

      replication_factor = 1
      consistency_mode = "consistent"
      compression_level = "none"

      # RPC fields are required but not used since replication_factor = 1
      rpc_bind_addr = "127.0.0.1:3901"

      [s3_api]
      s3_region = "garage"
      api_bind_addr = "[::]:3900"

      [s3_web]
      bind_addr = "[::]:3902"
      root_domain = "web.s3.wagner.gg"

      [admin]
      api_bind_addr = "0.0.0.0:3903"

hostPaths:
  - name: data
    hostPath: /srv/nvme/container-data/garage
    containerPath: /var/lib/garage
